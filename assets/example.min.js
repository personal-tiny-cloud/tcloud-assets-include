function setMsg(d){$("msg").style.color="white",$("msg").innerHTML=d}function setErrorMsg(d){$("msg").style.color="red",$("msg").innerHTML=d}async function submit(){var d=Object.fromEntries(new FormData($("register")));if(d.password_rep!=d.password){setErrorMsg("Passwords do not match.");return}delete d.password_rep;if(d.totp_as_qr=="on")d.totp_as_qr=!0;else d.totp_as_qr=!1;$("btn").disabled=!0;let e=await fetch(prefix+"api/auth/register",{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(d)});if(e.status!==200){let f=await e.json();console.log(f);if(f.error=="AuthError")setErrorMsg("Authentication Error:<br>"+f.msg);else if(f.error=="TokenError")setErrorMsg("Token Error:<br>"+f.msg);else setErrorMsg("Unknown error... check logs if this persists")}else{let f=await e.json();setMsg("");console.log(f);$("register").style.display="none";$("totp").hidden=!1;if(d.totp_as_qr){let g=$("totp-qr");g.src="data:image/png;base64, "+f.totp_qr;g.hidden=!1}else $("totp-url").innerHTML=f.totp_url}$("btn").disabled=!1}window.onload=function(){$("register").onsubmit=function(d){d.preventDefault();try{setMsg("Registering..."),submit()}catch(e){setErrorMsg("A JS error occurred, check logs for more info and open an issue if this persists"),console.log(e)}return !1},$("continue").onclick=function(d){window.location.reload()},$("totp_as_qr").checked=!0};